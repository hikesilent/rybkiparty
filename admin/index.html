<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #f5f5f5;
    }
    #app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    #auth-container, #cms-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    #cms-container {
      display: none;
      width: 100%;
    }
    #nc-root {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    button {
      background: #24292e;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 0;
    }
    #loading {
      margin: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="app-container">
    <!-- Kontener logowania -->
    <div id="auth-container">
      <h1>Logowanie do panelu admina</h1>
      <button id="github-login">Zaloguj przez GitHub</button>
      <p id="auth-error" style="color: red;"></p>
      <div id="loading" style="display: none;">Trwa ładowanie...</div>
    </div>

    <!-- Kontener CMS -->
    <div id="cms-container">
      <button id="logout-btn">Wyloguj</button>
      <div id="nc-root"></div>
    </div>
  </div>

  <script>
    // Konfiguracja Firebase - ZASTĄP SWOIMI WARTOŚCIAMI
    const firebaseConfig = {
  apiKey: "AIzaSyDv8zijZhIP3ceuGEyGI2RA4OSnh9iXqHc",
  authDomain: "rybki-party.firebaseapp.com",
  projectId: "rybki-party",
  storageBucket: "rybki-party.firebasestorage.app",
  messagingSenderId: "985551857623",
  appId: "1:985551857623:web:5b66f04f0708c3feca0d92",
  measurementId: "G-G8KF8YWEP0"
    };

    // Zmienna do śledzenia stanu CMS
    let cmsInitialized = false;

    // Inicjalizacja Firebase
    function initializeFirebase() {
      try {
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
          console.log("Firebase initialized");
        }
        setupAuth();
      } catch (error) {
        console.error("Firebase init error:", error);
        document.getElementById('auth-error').textContent = 
          "Błąd inicjalizacji systemu. Odśwież stronę.";
      }
    }

    // Obsługa autentykacji
    function setupAuth() {
      const authContainer = document.getElementById('auth-container');
      const cmsContainer = document.getElementById('cms-container');
      const loginBtn = document.getElementById('github-login');
      const logoutBtn = document.getElementById('logout-btn');
      const loading = document.getElementById('loading');

      // Logowanie przez GitHub
      loginBtn.addEventListener('click', () => {
        loading.style.display = 'block';
        const provider = new firebase.auth.GithubAuthProvider();
        provider.addScope('read:user');
        
        firebase.auth().signInWithPopup(provider)
          .catch(error => {
            loading.style.display = 'none';
            document.getElementById('auth-error').textContent = 
              `Błąd logowania: ${error.message}`;
          });
      });

      // Wylogowanie
      logoutBtn.addEventListener('click', () => {
        if (cmsInitialized) {
          // Czyszczenie CMS przed wylogowaniem
          const cmsRoot = document.getElementById('nc-root');
          if (cmsRoot) cmsRoot.innerHTML = '';
          cmsInitialized = false;
        }
        firebase.auth().signOut();
      });

      // Monitorowanie stanu logowania
      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          authContainer.style.display = 'none';
          cmsContainer.style.display = 'flex';
          loadCMS();
        } else {
          authContainer.style.display = 'flex';
          cmsContainer.style.display = 'none';
          loading.style.display = 'none';
        }
      });
    }

    // Ładowanie Decap CMS
    function loadCMS() {
      if (cmsInitialized) return;
      
      const loading = document.getElementById('loading');
      loading.style.display = 'block';

      // Dynamiczne ładowanie skryptu CMS
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js';
      
      script.onload = () => {
        // Dodatkowe opóźnienie dla pewności
        setTimeout(() => {
          try {
            CMS.init();
            console.log("CMS initialized");
            cmsInitialized = true;
          } catch (error) {
            console.error("CMS init error:", error);
            document.getElementById('auth-error').textContent = 
              "Błąd ładowania panelu admina. Odśwież stronę.";
          }
          loading.style.display = 'none';
        }, 300);
      };
      
      script.onerror = () => {
        loading.style.display = 'none';
        document.getElementById('auth-error').textContent = 
          "Nie udało się załadować panelu admina.";
      };
      
      document.head.appendChild(script);
    }

    // Start aplikacji
    document.addEventListener('DOMContentLoaded', initializeFirebase);
  </script>
</body>
</html>