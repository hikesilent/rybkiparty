<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Panel CMS</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <style>
      #login-form, #cms-panel {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="login-form">
      <h2>Zaloguj się do panelu</h2>
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Hasło" />
      <button id="login-btn">Zaloguj</button>
    </div>

    <div id="cms-panel">
      <button id="logout-btn">Wyloguj</button>
      <div id="cms-root"></div>
    </div>

    <script>
      // Konfiguracja Firebase
      const firebaseConfig = {
      apiKey: "AIzaSyDv8zijZhIP3ceuGEyGI2RA4OSnh9iXqHc",
      authDomain: "rybki-party.firebaseapp.com",
      projectId: "rybki-party",
      storageBucket: "rybki-party.appspot.com",
      messagingSenderId: "985551857623",
      appId: "1:985551857623:web:5b66f04f0708c3feca0d92",
      measurementId: "G-G8KF8YWEP0"
      };

      firebase.initializeApp(firebaseConfig);
      console.log("Firebase initialized successfully");

      const loginForm = document.getElementById("login-form");
      const cmsPanel = document.getElementById("cms-panel");
      const logoutBtn = document.getElementById("logout-btn");

      // Obsługa logowania
      document.getElementById("login-btn").addEventListener("click", () => {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        firebase.auth().signInWithEmailAndPassword(email, password)
          .catch(error => alert("Błąd logowania: " + error.message));
      });

      // Obsługa wylogowania
      logoutBtn.addEventListener("click", () => {
        firebase.auth().signOut().then(() => location.reload());
      });

      // Inicjalizacja CMS
      let cmsInitialized = false;

      function loadCMS() {
        if (cmsInitialized) return;

        const script = document.createElement("script");
        script.src = "https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js";
        script.onload = () => {
          window.CMS.init();
          console.log("Decap CMS initialized successfully");
          cmsInitialized = true;
        };
        document.body.appendChild(script);
      }

      // Obserwacja statusu logowania
      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          loginForm.style.display = "none";
          cmsPanel.style.display = "block";
          document.getElementById("cms-root").style.display = "block";
          loadCMS();
        } else {
          loginForm.style.display = "block";
          cmsPanel.style.display = "none";
        }
      });
    </script>
  </body>
</html>
