<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
    #login-container, #cms-container { text-align: center; margin-top: 50px; }
    button { 
      background: #24292e; color: white; 
      border: none; padding: 10px 20px; 
      border-radius: 5px; cursor: pointer;
    }
    #cms-container { display: none; }
  </style>
</head>
<body>

<!-- Ekran logowania -->
<div id="login-container">
  <h1>Logowanie do panelu</h1>
  <button id="github-login">Zaloguj przez GitHub</button>
  <p id="error-message" style="color: red;"></p>
</div>

<!-- Kontener CMS (pokazuje się po zalogowaniu) -->
<div id="cms-container">
  <h1>Witaj w panelu admina!</h1>
  <button id="logout-btn">Wyloguj</button>
  <div id="nc-root"></div> <!-- Tutaj załaduje się Decap CMS -->
</div>

<script>
  // Konfiguracja Firebase
  const firebaseConfig = {
  apiKey: "AIzaSyDv8zijZhIP3ceuGEyGI2RA4OSnh9iXqHc",
  authDomain: "rybki-party.firebaseapp.com",
  projectId: "rybki-party",
  storageBucket: "rybki-party.firebasestorage.app",
  messagingSenderId: "985551857623",
  appId: "1:985551857623:web:5b66f04f0708c3feca0d92",
  measurementId: "G-G8KF8YWEP0"
  };
  firebase.initializeApp(firebaseConfig);

  // Elementy DOM
  const loginContainer = document.getElementById('login-container');
  const cmsContainer = document.getElementById('cms-container');
  const errorMessage = document.getElementById('error-message');
  const loginBtn = document.getElementById('github-login');
  const logoutBtn = document.getElementById('logout-btn');

  // Logowanie przez GitHub
  loginBtn.addEventListener('click', () => {
    const provider = new firebase.auth.GithubAuthProvider();
    firebase.auth().signInWithPopup(provider)
      .then(() => { /* Zalogowano pomyślnie - obsłużone w onAuthStateChanged */ })
      .catch(error => {
        errorMessage.textContent = `Błąd logowania: ${error.message}`;
      });
  });

  // Wylogowanie
  logoutBtn.addEventListener('click', () => {
    firebase.auth().signOut();
  });

  // Obsługa stanu logowania
  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      // Użytkownik zalogowany
      loginContainer.style.display = 'none';
      cmsContainer.style.display = 'block';
      loadCMS();
    } else {
      // Użytkownik wylogowany
      loginContainer.style.display = 'block';
      cmsContainer.style.display = 'none';
    }
  });

  // Ładowanie Decap CMS
  function loadCMS() {
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js';
    script.onload = () => {
      // Inicjalizacja z małym opóźnieniem
      setTimeout(() => CMS.init(), 100);
    };
    document.head.appendChild(script);
  }
</script>
</body>
</html>